<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      /* #### Generated By: http://www.cufonfonts.com #### */

      @font-face {
        font-family: 'Monaco';
        font-style: normal;
        font-weight: normal;
        src: local('Monaco'), url('Monaco.woff') format('woff');
      }

      body {
        margin: 50px;
        background-color: #c4c4c4;
      }
      /*------------------ search -----------------*/

      input[type='search']::-webkit-search-decoration,
      input[type='search']::-webkit-search-cancel-button,
      input[type='search']::-webkit-search-results-button,
      input[type='search']::-webkit-search-results-decoration {
        -webkit-appearance: none;
      }

      #search-container {
        width: 746px;
        position: relative;
      }
      .ais-SearchBox-input {
        width: 100%;
        height: 40px;
        padding-left: 35px;
        font-size: medium;
        border: none;
      }
      .ais-SearchBox-input:focus {
        outline: none;
      }
      .ais-SearchBox-input::placeholder {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        font-size: 14px;
        color: #949494;
      }

      /*------------------ search icon -----------------*/

      .ais-SearchBox-submitIcon path {
        margin: 0;
        width: 100%;
        fill: #757575;
      }
      .ais-SearchBox-submitIcon {
        width: 20px;
        height: 20px;
        position: absolute;
        top: 12px;
        left: 12px;
        fill: #eeeeee;
      }

      /*------------------ search close button -----------------*/

      #close-search {
        background-color: white;
        border: 0 solid grey;
        color: grey;
        padding-left: 10px;
        /* padding-top: 2px; */
        position: absolute;
        top: 6px;
        right: 6px;
        height: 28px;
      }
      #close {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        font-size: 14px;
        color: #949494;
        cursor: pointer;
        /* padding-bottom: 3px; */
      }

      /*------------------ CF promo and links -----------------*/

      #promo {
        background-color: white;
        width: 100%;
        margin: 0 0 4px;
        /* padding: 1px 0 1px; */
      }
      #cf {
        margin: 2px;
        padding-bottom: 4px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 14px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      }
      a:link,
      a:visited,
      a:hover,
      a:active {
        color: #2b2b2b;
        text-decoration: underline;
      }

      /*------------------ hits -----------------*/

      #hits-and-promo {
        display: none;
        /* border: 1px solid grey; */
        flex-direction: column;
        overflow-y: auto;
      }
      #hits-and-promo::-webkit-scrollbar {
        width: 0; /* width of the entire scrollbar */
      }
      .ais-Hits-list {
        list-style: none;
        background-color: rgb(255, 255, 255);
        margin: 0;
        padding: 1px;
      }
      .ais-Hits-item {
        display: block;
        margin: 5px;
        padding: 20px;
        background-color: #f7f9fc;
        border-radius: 4px;
        border: 1px solid #dfe5ee;
      }
      p {
        margin: 0;
        white-space: normal;
      }
      .hit-text {
        margin: 0;
        padding: 0;
        white-space: normal;
      }
      pre {
        margin: 0;
      }
      .hit-description,
      .hit-code {
        padding: 3px;
        font-size: 13px;
        white-space: pre-wrap;
      }
      .hit-description {
        font-style: italic;
        color: #5c6370;
      }
      .ais-Highlight-highlighted {
        background-color: hsl(115, 100%, 78%);
      }
      /* seems like they changed highlighting style */
      em {
        /* background-color: hsl(0, 0%, 100%); */
        text-decoration: none;
        font-style: inherit;
        font-weight: 900;
        color: inherit;
      }
      .ais-Hits--empty {
        background-color: white;
        padding: 10px;
        display: flex;
        justify-content: center;
        font-size: 14px;
      }
      .hljs-string {
        color: #32a846;
      }
      .print {
        color: #ca8d3d;
      }
      .hljs-number {
        color: #56b6c2;
      }
      .hljs-build_in {
        color: #c678dd;
      }
    </style>
  </head>
  <body>
    <div id="search-container">
      <svg class="ais-SearchBox-submitIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">
        <path
          d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"
        ></path>
      </svg>
      <button id="close-search" onclick="closeSearch()"><code id="close">Close (Esc)</code></button>
    </div>

    <div id="hits-and-promo">
      <div id="promo">
        <code>
          <p id="cf"><a href="">Try out stand-alone app for search and personal knowledge base</a></p>
        </code>
      </div>
      <div id="hits">
        <!-- реклама CF -->
        <!-- ссылка на посмотреть ве записи? отдельный док -->
        <!-- ссылка на фидбэк / запрос по поиску -->
        <!-- спрятать / не загружать на старте хиты, только когда нажимают на поиск? -->
        <!-- координаты относительно searchbar.getBoundingClientRect() ? -->
        <!-- стиль хитов такой же как у код боков на платформе -->
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.0.0/dist/algoliasearch-lite.umd.js" integrity="sha256-MfeKq2Aw9VAkaE9Caes2NOxQf6vUa8Av0JqcUXUGkd0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.0.0/dist/instantsearch.production.min.js" integrity="sha256-6S7q0JJs/Kx4kb/fv0oMjS855QTz5Rc2hh9AkIUjUsk=" crossorigin="anonymous"></script>

    <script>
      const searchClient = algoliasearch('CJ53QCT2H5', '501bc011527c6b85bc6b69bd0a6da081');

      const search = instantsearch({
        indexName: 'practicum-search',
        searchClient,
        routing: false,
        searchFunction: function (helper) {
          var searchResults = document.querySelector('#hits-and-promo');
          if (helper.state.query === '') {
            searchResults.style.display = 'none';
            return;
          }
          helper.search();
          searchResults.style.display = 'flex';
        },
      });

      search.addWidgets([
        instantsearch.widgets.searchBox({
          container: '#search-container',
          placeholder: 'Forgot something? Search it here (Keyboard Shortcut)',
          autofocus: false,
          showReset: false,
          showSubmit: false,
        }),
      ]);

      search.addWidgets([
        instantsearch.widgets.hits({
          container: '#hits',
          escapeHTML: false,
          templates: {
            item: `
          <div class='hits'>
            <pre class="hit-text hit-description">{{#helpers.highlight}}{ "attribute": "description" }{{/helpers.highlight}}</pre>
            <pre class="hit-text hit-code">{{#helpers.highlight}}{ "attribute": "code_snippet" }{{/helpers.highlight}}</pre>
          </div>`,
            empty: `<code><p>Sorry. No snippets on this topic yet. Send a messege to <a href=''> learning support</a></p></code>`,
          },
        }),
      ]);

      search.addWidgets([
        instantsearch.widgets.configure({
          hitsPerPage: 10,
        }),
      ]);

      search.start();

      // надо скрывать хиты на старте, а то путают. поиск с чистого листа

      // возможно надо будет написать новыю рендер функцию

      var searchBar = document.querySelector('.ais-SearchBox-input');
      var hits = document.querySelector('#hits-and-promo');

      function modalPosition() {
        let gap = 5;
        let top = document.querySelector('.ais-SearchBox').getBoundingClientRect().top + document.querySelector('.ais-SearchBox').getBoundingClientRect().height + gap;
        let left = document.querySelector('.ais-SearchBox').getBoundingClientRect().left;
        let width = Math.round(document.querySelector('.ais-SearchBox').getBoundingClientRect().width);
        // let height = window.innerHeight - top - 44
        let height = 351; // примерный размер секции resilt
        hits.style.top = `${top}.px`;
        hits.style.left = `${left}.px`;
        hits.style.width = `${width}.px`;
        hits.style.height = `${height}.px`;
        hits.style.position = 'absolute';
      }

      modalPosition();

      searchBar.onfocus = function () {
        modalPosition();
        hits.style.display = 'flex';
      };

      document.addEventListener('keyup', (e) => {
        if (e.code == 'Escape' || (e.shiftKey && e.key == 'Enter') || (e.ctrlKey && e.key == 'Enter')) {
          closeSearch();
        }
      });

      document.addEventListener('keyup', (e) => {
        if (e.shiftKey && e.code == 'KeyK') {
          searchBar.focus();
        }
      });

      window.addEventListener('beforeunload', function (event) {
        closeSearch();
      });

      // показывает предыдущий поиск, баг или фича?
      function closeSearch() {
        hits.style.display = 'none';
        document.querySelector('.ais-SearchBox-form').reset();
        document.querySelector('.ais-SearchBox-input').blur();
        hits.style.display = 'none';
      }
    </script>
  </body>
</html>
